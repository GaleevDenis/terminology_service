# Тестовое задание для стажировки (python)
# Разработать сервис терминологии и REST API к нему


## Технологии


*  **Python = 3.11.9**
*  **Django = 4.2.15**


### Дополнительные библиотеки:
*  **djangorestframework = 3.15.2**
*  **django-debug-toolbar = 4.4.6**
*  **drf-yasg = 1.21.7**


**Для описания и проверки API подключен swagger. Все методы и примеры использования описаны.**


## Установка сервиса (локально):


**\*Инструкция для OS Windows**


**1. Установить Python.**


* Если у вас еще нет Python, скачайте и установите: **3.8.X >= Версия >= 3.12.X** с официального сайта: [https://www.python.org/downloads](https://www.python.org/downloads) , стабильность проверена на **версии 3.11.9**.


**2. Установить Git.**


* Если у вас еще нет Git, скачайте и установите его с официального сайта: [https://git-scm.com/downloads](https://git-scm.com/downloads)


**3. Клонирование репозитория:**


1. Откройте **git bash** перейдите в директорию где будете разворачивать проект и создайте репозиторий, к примеру:
```bash
{UserName}@HOME-PC MINGW64 ~
$ cd Desktop/ ; mkdir dev_env ; cd dev_env
```
2. Выполните команду **git clone** чтобы скопировать проект с адресом указанным по этой [ссылке](https://github.com/GaleevDenis/terminology_service.git)
```bash
{UserName}@HOME-PC MINGW64 ~Desktop/dev_env
$ git clone https://github.com/GaleevDenis/terminology_service.git
```


**4. Создание и активация виртуального окружения:**


1. Откройте командную строку используя команду **Win + R** и введите **cmd**, перейдите в папку **dev_env** (используя команду **cd**):
```bat
C:\Users\{UserName}\cd Desktop\dev_env\
```
2. Создадим изолированное **виртуальное окружение** интерпретатора **Python** используя команду **venv** {имя_виртуального окружения}:
```bat
C:\Users\{UserName}\Desktop\dev_env\python -m venv venv
```
3. Активируем **виртуальное окружение**, после активации слева от корневого каталога в командной строке должно появиться **(venv)** :
```bat
C:\Users\{UserName}\Desktop\dev_env\venv\Scripts\activate
```


**5. Установка библиотек нашего проекта:**


1. Загрузим все зависимые **библиотеки** для нашего проекта:
```bat
(venv) C:\Users\{UserName}\Desktop\dev_env\pip install -r requirements.txt
```
2. Перейдем в рабочую директорию нашего проекта:
```bat
(venv) C:\Users\{UserName}\cd Desktop\dev_env\cd terminology_service
```


**5. Запуск проекта:**


1. Запустим наш проект:
```bat
(venv) C:\Users\{UserName}\cd Desktop\dev_env\terminology_service\manage.py runserver
```
2. Доступные **URL-адреса** в (параметрах уберите символ **"\\\"**):


* **[Swagger](http://127.0.0.1:8000/swagger/):** Описание работы сервиса (документация) и тестирования API.
* **[Административная панель](http://127.0.0.1:8000/admin/):** Чтобы войти с правами администратора - Логин и Пароль: **root**
* **[Получение списка справочников](http://127.0.0.1:8000/refbooks/):** Получение списка всех справочников.
* **[Получение списка справочников актуальных на указанную дату](http://127.0.0.1:8000/refbooks/?date=2020-09-14):** В параметр **[?date=<\date>]** укажите **дату в формате ГГГГ-ММ-ДД**\*.
   * \*Возвращает справочники, в которых имеются версии с **датой начала действия раннее или равной указанной**.
* Если введена некорректная дата возвращает ошибку **400** с описанием.
* **[Получение элементов заданного справочника](http://127.0.0.1:8000/refbooks/1/elements/):** В параметр пути **[<\int:id>]** укажите **идентификатор справочника**. Возвращает элементы **текущей версии**\*.
   * \*Текущей является та версия, дата начала действия которой позже всех остальных версий данного справочника, но не позже текущей даты.
* **[Получение элементов заданного справочника и указанной версии](http://127.0.0.1:8000/refbooks/1/elements/?version=1.0):** В параметр пути **[<\int:id>]** укажите **идентификатор справочника** и в параметр **[?version=<\version>] версию справочника.**
* **[Проверка на наличие элемента в справочнике](http://127.0.0.1:8000/refbooks/1/check_element/?code=3&value=Хирург):** В параметр пути **[<\int:id>]** укажите **идентификатор справочника**, в параметр **[?code=<\code>] код элемента справочника**, в **[?value=<\value>] значение элемента справочника**.  Возвращает элементы **текущей версии**\*.
   * \*Текущей является та версия, дата начала действия которой позже всех остальных версий данного справочника, но не позже текущей даты.
* **[Проверка на наличие элемента в справочнике с указанной версией](http://127.0.0.1:8000/refbooks/1/check_element/?code=3&value=Хирург&version=1.1):** В параметр пути **[<\int:id>]** укажите **идентификатор справочника**, в параметр **[?code=<\code>] код элемента справочника**, в **[?value=<\value>] значение элемента справочника**, в **[?version=<\version>] версию справочника**.


***Если справочники, элементы, элемент не найден(ы) возвращает ошибку 404 с описанием**.


3. \*Имеется возможность запустить **функциональные тесты** сервиса:
```bat
(venv) C:\Users\{UserName}\cd Desktop\dev_env\terminology_service\manage.py test
```
* **После завершения тестов вы увидите сообщение:** Сообщение **ОК** - все тесты пройдены успешно.
```bat
Found 10 test(s).
Creating test database for alias 'default'...
System check identified no issues (0 silenced).
..........
----------------------------------------------------------------------
Ran 10 tests in 0.029s

OK
```


## Сервис терминологии оперирует следующими объектами и их атрибутами:


**1. Справочник:**


* **Идентификатор:**  Уникальное значение справочника типа integer, создается автоматически.
* **Код:**  Код справочника (строка, максимальная длина 100 символов, не может быть пустой, уникальное значение).
* **Наименование:**  Наименование справочника (строка, максимальная длина 300 символов, не может быть пустой).
* **Описание:**  Подробное описание справочника (текст произвольной длины).


**2. Версия справочника.**


* **Идентификатор:**  Уникальное значение версии справочника типа integer, создается автоматически (не может быть пустой).
* **Идентификатор справочника:**  Идентификатор объекта "Справочник" справочник к которому относится версия справочника (не может быть пустой).
* **Версия:**  Версия справочника (строка, максимальная длина 50 символов, не может быть пустой).
* **Дата начала действия:**  Дата, когда данная версия справочника вступает в силу (не может быть пустой).


**3. Элемент справочника:**


* **Идентификатор:**  Уникальный идентификатор элемента типа integer, создается автоматически (не может быть пустой)
* **Идентификатор Версии справочника:** Идентификатор объекта "Версия справочника" версия справочника, к которому относится элемент (не может быть пустой)
* **Код элемента:**  (строка, 100 символов, не может быть пустой).
* **Значение элемента:**  (строка, 300 символов, не может быть пустой)


#### Ограничения при инициализации атрибутов (реализованы программно):


* Не может существовать более одного справочника с одинаковым значением в поле код.
* Не может существовать более одной версии с одинаковым набором значений "Идентификатор справочника" и "Версия".
* У одного справочника не может быть более одной версии с одинаковой "Датой начала".
* В одной версии справочника не может существовать более одного элемента справочника с одинаковым значением в поле код.

## API предоставляет следующие методы:
1. **Тип запроса HTTP: GET**
2. **Убрать символ "\\\" в запросах**


### **Получение списка справочников:**

* **refbooks/** - Получение списка всех справочников
* **refbooks/[?date=<\date>]** - Получение списка справочников в которых имеются версии с датой начала действия раннее или равной указанной в **date**.
* **date** - Дата начала действия версии
#### Формат ответа:
 * **id** - Идентификатор справочника
 * **code** - Код справочника
 * **name** - Наименование справочника


#### Примеры ответов:
**status 200: Удачная операция**
```
{
  "refbooks": [
    {
      "id": 1,
      "code": "1",
      "name": "Специальности медицинских работников"
    },
    {
      "id": 2,
      "code": "2",
      "name": "Справочник болезней"
    },
    {
      "id": 3,
      "code": "3",
      "name": "Список адресов"
    }
  ]
}
```
**status 400: Некорректный формат даты**
```
{
  "error": [
    "Введен некорректный формат даты - корректный формат: YYYY-MM_DD"
  ]
}
```
**status 404: Не найдены справочники**
```
{
  "not_found": [
    "Не найдены справочники"
  ],
  "not_found_2": [
    "Не найдены справочники с датой начала действия версии раннее или равной указанной"
  ]
}
```


### **Получение элементов справочника:**


* **refbooks/<\id>/elements/** - Получение элементов справочника с указанным **id**, возвращает элементы **текущей версии**.
* **refbooks/<\id>/elements/[?version=<\version>]** Получение элементов справочника с указанным **id** и **version**.


* **id** - Идентификатор справочника
* **version** - Версия справочника
* **Текущая версия** - дата начала действия которой позже всех остальных версий данного справочника, но не позже текущей даты.
#### Формат ответа:
 * **code** - Код элемента
 * **value** - Значение элемента


#### Примеры ответов:
**status 200: Удачная операция**
```
{
  "elements": [
    {
      "code": "1",
      "value": "Вирусная инфекция"
    },
    {
      "code": "2",
      "value": "Лихорадка"
    }
  ]
}
```
**status 404: Не найдены элементы**
```
{
  "not_found": [
    "Не найдены элементы указанной версии справочника"
  ],
  "not_found_2": [
    "Не найдены элементы текущей версии справочника"
  ]
}
```

### **Валидация элемента справочника:**


* **refbooks/<\id>/check_element/?code=<\code>&value=<\value>** - Валидация элемента справочника по указанному **id**, **code**, **value**, **текущей версии**
* **refbooks/<\id>/check_element/?code=<\code>&value=<\value>[&version=<\version>]** - Валидация элемента справочника по указанному **id**, **code**, **value**, **version**


* **id** - Идентификатор справочника
* **code** - Код элемента справочника
* **value** - Значение элемента справочника
* **version** - Версия справочника
* **Текущая версия** - дата начала действия которой позже всех остальных версий данного справочника, но не позже текущей даты.
#### Формат ответа:
 * **code** - Код элемента справочника
 * **value** - Значение элемента справочника


#### Примеры ответов:
**status 200: Удачная операция**
```
{
  "validation": [
    {
      "code": "3",
      "value": "Хирург"
    }
  ]
}
```
**status 404: Не найден элемент**
```
{
  "not_found": [
    "Не найден элемент"
  ]
}
```


## Административная панель


### **Список справочников:**


**Отображаемые поля:**
 * Идентификатор
 * Код
 * Наименование
 * Текущая версия
 * Дата начала действия версии


**Добавление, изменение, удаление справочников.**


**При редактировании справочника заполняются поля:** 
 * Код (строка, обязательно для заполнения)
 * Наименование (строка,обязательно для заполнения)
 * Описание (текст произвольной длинны).


**При редактировании справочника на этой же странице отображается список имеющихся версий данного справочника с возможностью редактирования.**


### **Список версий справочников:**


**Отображаемые поля:**
 * Код справочника
 * Наименование справочника
 * Версия
 * Дата начала версии.


**Добавление, изменение, удалении версии справочника**


**При редактировании версии справочника заполняются поля:** 


 * Справочник (выбор из списка)
 * Версия (строка)
 * Дата начала действия (выбор из календаря)


**При редактировании версии на этой же странице возможно редактирование элементов справочника в этой версии.**
### **Элементы справочников:**


**Отображаемые поля:**
 * Код элемента
 * Значение элемента
 * Справочник - версия


**Добавление, изменение, удалении элементов справочника**


**При редактировании элементов заполняются поля:**


 * Версия (выбор из списка "справочник-версия")
 * Код элемента (строка)
 * Значение элемента (строка).


**Язык интерфейса административной панели  - русский**